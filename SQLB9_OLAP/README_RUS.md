## _Aggregated data is more informative, isn't it?_

В этом проекте ты освоишь ключевые практические навыки SQL-анализа, необходимые для решения реальных бизнес-задач: агрегацию данных (расчет сумм, средних, минимума/максимума), группировку по атрибутам, фильтрацию результатов, соединение таблиц и работу с условиями.

Ты научишься превращать сырые данные из базы в структурированные отчеты, рассчитывать метрики эффективности, анализировать поведение клиентов и принимать обоснованные бизнес-решения на основе данных.

Убедись, что все изменения, которые были внесены в проект SQLB4_DML (Day 03) в ходе Заданий 07-13, и в проект SQLB5_Snapshots (Day 04) Задание 07, должны сохраняться (это похоже на реальную ситуацию, когда после выпуска релиза требуется обеспечить согласованность данных для новых изменений).

## Задание 00 — Simple aggregated information

Выполним простую агрегацию. Напиши SQL-запрос, который возвращает идентификаторы людей (person_id) и соответствующее количество посещений любых пиццерий.

Отсортируй результат по количеству посещений в порядке убывания (descending), а затем по идентификатору человека (person_id) в порядке возрастания (ascending).

Пример данных ниже

| person_id | count_of_visits |
| ----- | ----- |
| 9 | 4 |
| 4 | 3 |
| ... | ... |

## Задание 01 — Let's see real names

Измени SQL-запрос из Задания 00 так, чтобы он возвращал имя человека (name), а не его идентификатор.

Дополнительное условие - нужно вывести только топ-4 человека с максимальным количеством визитов в каждой пиццерии, отсортированных по имени человека. Ниже приведен пример результата.

| name | count_of_visits |
|------|-----------------|
| Dmitriy | 4 |
| Denis | 3 |
| ... | ... |

## Задание 02 — Restaurants statistics

Напиши SQL-запрос, который выведет топ-3 заведения, которые являются самыми популярными по количеству посещений и по количеству заказов, объединив результаты в один список.

Добавь столбец action_type, который будет содержать значения 'order' (заказ) или 'visit' (посещение) в зависимости от того, из какой таблицы взяты данные.

Ознакомься с примером данных ниже.

Отсортируйте итоговый результат в порядке возрастания по столбцу action_type и в порядке убывания по столбцу с количеством (count).

| name | count | action_type |
|------|-------|-------------|
| Dominos | 6 | order |
| ... | ... | ... |
| Dominos | 7 | visit |
| ... | ... | ... |

## Задание 03 — Restaurants statistics #2

Напиши SQL-запрос, который покажет, как рестораны группируются по количеству посещений и по количеству заказов, а затем объединит эти данные по названию пиццерии.

Можно использовать внутренний запрос из Задания 02 (Restaurants by Visits and by Orders) без каких-либо ограничений на количество строк.

Добавь следующие правила:

- Вычисли общую сумму заказов и посещений для каждой пиццерии (учитывай, что не все пиццерии могут присутствовать в обеих таблицах).
- Отсортируй результаты по столбцу total_count (общее количество) в порядке убывания, а затем по столбцу name (название) в порядке возрастания.

Ознакомься с примером данных ниже.

| name | total_count |
|------|-------------|
| Dominos | 13 |
| DinoPizza | 9 |
| ... | ... |

## Задание 04 — Clause for groups

| **Запрещено** | |
| Синтаксическая конструкция | WHERE |

Напиши SQL-запрос, который возвращает имя человека (person name) и соответствующее количество посещений любых пиццерий при условии, что это количество превышает 3 раза (> 3).

Ознакомься с примером данных ниже.

| name | count_of_visits |
|------|-----------------|
| Dmitriy | 4 |

## Задание 05 — Person's uniqueness

| **Запрещено** | |
| Синтаксическая конструкция | GROUP BY, any type (UNION,...) working with sets |

Напиши простой SQL-запрос, который возвращает список уникальных имен людей, сделавших хотя бы один заказ в любой из пиццерий.

Отсортируй результат по имени человека.

Ознакомься с примером ниже.

| name |
|------|
| Andrey |
| Anna |
| ... |

## Задание 06 — Restaurant metrics

Напиши SQL-запрос, который возвращает для каждой пиццерии:

- общее количество заказов,
- среднюю цену,
- максимальную цену
- и минимальную цену на проданные пиццы.

Результат должен быть отсортирован по названию пиццерии. Округли среднюю цену до двух знаков после запятой.

Ознакомься с примером данных ниже.

| name | count_of_orders | average_price | max_price | min_price |
|------|-----------------|---------------|-----------|-----------|
| Best Pizza | 5 | 780 | 850 | 700 |
| DinoPizza | 5 | 880 | 1000 | 800 |
| ... | ... | ... | ... | ... |

## Задание 07 — Average global rating

Напиши SQL-запрос, который возвращает общий средний рейтинг (выходной атрибут назови global_rating) для всех ресторанов.

Округли среднее значение рейтинга до 4 знаков после запятой.

## Задание 08 — Find pizzeria's restaurant locations

Из данных известны личные адреса людей. Предположим, что человек посещает только пиццерии в своем городе.

Напиши SQL-запрос, который возвращает:

1. Адрес (person address)
2. Название пиццерии (pizzeria name)
3. Число его заказов (count of orders) в этой пиццерии.

Отсортируй результат сначала по адресу, а затем по названию заведения.

Ознакомься с примером выходных данных ниже.

| address | name | count_of_orders |
|---------|------|-----------------|
| Kazan | Best Pizza | 4 |
| Kazan | DinoPizza | 4 |
| ... | ... | ... |

## Задание 09 — Explicit type transformation

Напиши SQL-запрос, который возвращает агрегированную информацию по адресу каждого человека.

В результат должны быть включены:

- вычисляемый столбец с формулой: «Максимальный возраст - (Минимальный возраст / Максимальный возраст)»,
- средний возраст по каждому адресу average age per address),
- результат сравнения формулы и среднего возраста (то есть, если значение формулы больше среднего возраста, то значение должно быть True, иначе - False).

Результат необходимо отсортировать по столбцу с адресом.

Ниже приведен пример ожидаемых данных.

| address | formula | average | comparison |
|---------|---------|---------|------------|
| Kazan | 44.71 | 30.33 | true |
| Moscow | 20.24 | 18.5 | true |
| ... | ... | ... | ... |